version: '3.8'

services:
  # ===========================================
  # BACKEND - .NET 9 API
  # ===========================================
  api:
    build:
      context: ./src/backend
      dockerfile: Dockerfile
    container_name: ppro-api
    restart: unless-stopped
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:5000
      - ConnectionStrings__MySQL=Server=newdataserver.mysql.database.azure.com;Port=3306;Database=ppro;Uid=dataserver_wp;Pwd=wpadm%40753;SslMode=Preferred;CertificateFile=/app/ca-certificate.pem;CharSet=utf8mb4;
      - ConnectionStrings__Redis=${REDIS_CONNECTION_STRING}
      - ConnectionStrings__Hangfire=Server=newdataserver.mysql.database.azure.com;Port=3306;Database=hangfire_ppro;Uid=dataserver_wp;Pwd=wpadm%40753;SslMode=Preferred;CertificateFile=/app/ca-certificate.pem;CharSet=utf8mb4;
      - Jwt__Secret=${JWT_SECRET:-PartnershipManager_SecretKey_2025_Min32Chars!}
      - Jwt__Issuer=${JWT_ISSUER:-PartnershipManager}
      - Jwt__Audience=${JWT_AUDIENCE:-PartnershipManagerApp}
      - Cors__Origins=http://localhost:3000,http://frontend:3000
    ports:
      - "5000:5000"
    networks:
      - pm-network

  # ===========================================
  # FRONTEND - React + Vite
  # ===========================================
  frontend:
    build:
      context: ./src/frontend
      dockerfile: Dockerfile
      target: development
    container_name: ppro-frontend
    restart: unless-stopped
    ports:
      - "3000:3000"
    depends_on:
      - api
    volumes:
      - ./src/frontend:/app
      - /app/node_modules
    networks:
      - pm-network

networks:
  pm-network:
    driver: bridge
